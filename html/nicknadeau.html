<!DOCTYPE html>
<html>
	<head>
		<title>Nick Nadeau - nicknadeau</title>
		<meta name="description" content="Nick Nadeau's nicknadeau page.">
		<meta name="viewport" content="width=device-width, initial-scale=1">
	</head>
	<body>
		#include "nicknadeau.h"
		<br>
		<br>#include <unistd.h>
		<br>#include <stdlib.h>
		<br>#include <stdbool.h>
		<br>#include <stdint.h>
		<br>#include <limits.h>
		<br>#include <errno.h>
		<br>
		<br>
		<br>LINK(about)
		<br>LINK(blog)
		<br>LINK(github)
		<br>LINK(native)
		<br>
		<br>
		<br>static void printInstructions() {
		<br>	printf(
		<br>		"To display a specific page, write the name of the page and then hit ENTER.\n"
		<br>		"To list the pages, write 'list' and then hit ENTER.\n"
		<br>		"To stop running, write 'exit' and then hit ENTER. Or, you know, the good ole CTRL+C.\n"
		<br>	);
		<br>}
		<br>
		<br>static void list() {
		<br>	printf(
		<br>		"\nPages: 'about', 'native', 'github', 'blog [post id]'"
		<br>		"\n\nNote: the 'post id' of a blog post is the number in square brackets listed on the blog page."
		<br>		"\nTo view the blog page itself and not a specific post, omit the post id."
		<br>		"\n"
		<br>	);
		<br>}
		<br>
		<br>static bool stringEquals(const char *expected, const char *buffer, uint32_t bufferSize) {
		<br>	uint32_t expectedSize = strlen(expected);
		<br>	return (expectedSize == bufferSize) && (0 == strncmp(expected, buffer, expectedSize));
		<br>}
		<br>
		<br>static bool stringBeginsWith(const char *prefix, const char *buffer, uint32_t bufferSize) {
		<br>	uint32_t prefixSize = strlen(prefix);
		<br>	return (prefixSize <= bufferSize) && (0 == strncmp(prefix, buffer, prefixSize));
		<br>}
		<br>
		<br>static uint32_t getBlogPostId(const char *buffer, uint32_t bufferSize, bool *out_hasId, bool *out_isInvalidId) {
		<br>	bool hasId = false;
		<br>	uint32_t prefixSize = strlen("blog");
		<br>	uint32_t id;
		<br>	if (prefixSize < bufferSize) {
		<br>		long value = strtol(buffer + prefixSize, NULL, 10);
		<br>		if ((LONG_MIN == value) || (LONG_MAX == value)) {
		<br>			*out_isInvalidId = true;
		<br>			return 0;
		<br>		}
		<br>		id = (uint32_t) value;
		<br>		hasId = true;
		<br>	}
		<br>	*out_hasId = hasId;
		<br>	return id;
		<br>}
		<br>
		<br>static void displayBlogPost(uint32_t postId) {
		<br>	printf("Displaying post %u\n", postId);
		<br>	//TODO implement for real.
		<br>}
		<br>
		<br>static void printPagePreamble(const char *pageName, uint32_t nameLength) {
		<br>	printf("\n===> Page: %.*s\n\n", nameLength, pageName);
		<br>}
		<br>
		<br>int main(int argc, const char **argv)
		<br>{
		<br>	char buffer[BUFSIZ];
		<br>	printInstructions();
		<br>	printf("\n# ");
		<br>	fflush(stdout);
		<br>	int bytesRead = read(STDIN_FILENO, buffer, BUFSIZ);
		<br>	while (bytesRead > 0) {
		<br>		uint32_t bufferSize = bytesRead - 1;
		<br>		if (BUFSIZ == bytesRead) {
		<br>			fprintf(stderr, "...What exactly are you trying to do?\n");
		<br>			return 1;
		<br>		} else if (stringEquals("exit", buffer, bufferSize)) {
		<br>			return 0;
		<br>		} else if (stringEquals("list", buffer, bufferSize)) {
		<br>			list();
		<br>		} else if (stringEquals("about", buffer, bufferSize)) {
		<br>			printPagePreamble(buffer, bufferSize);
		<br>			about();
		<br>		} else if (stringEquals("native", buffer, bufferSize)) {
		<br>			printPagePreamble(buffer, bufferSize);
		<br>			native();
		<br>		} else if (stringEquals("github", buffer, bufferSize)) {
		<br>			printPagePreamble(buffer, bufferSize);
		<br>			github();
		<br>		} else if (stringBeginsWith("blog", buffer, bufferSize)) {
		<br>			bool hasId = false;
		<br>			bool isInvalidId = false;
		<br>			uint32_t postId = getBlogPostId(buffer, bufferSize, &hasId, &isInvalidId);
		<br>			if (isInvalidId) {
		<br>				fprintf(stderr, "Invalid 'post id' given. Must be an integer.\n");
		<br>			} else if (hasId) {
		<br>				displayBlogPost(postId);
		<br>			} else {
		<br>				printPagePreamble(buffer, bufferSize);
		<br>				blog();
		<br>			}
		<br>		} else {
		<br>			printInstructions();
		<br>		}
		<br>		printf("\n# ");
		<br>		fflush(stdout);
		<br>		bytesRead = read(STDIN_FILENO, buffer, BUFSIZ);
		<br>	}
		<br>	if (0 == bytesRead) {
		<br>		fprintf(stderr, "**Exiting -> stdin was closed!\n");
		<br>	} else {
		<br>		fprintf(stderr, "**Exiting -> error reading stdin! errno=%d\n", errno);
		<br>	}
		<br>	return 1;
		<br>}
	</body>
</html>
